{"version":3,"file":"app.js","sourceRoot":"","sources":["../src/app.ts"],"names":[],"mappings":";;AAAA,mCAAmC;AACnC,MAAM,QAAQ,GAAG,OAAO,CAAC,UAAU,CAAC,CAAC;AAErC,wDAAwD;AAExD,IAAI,KAAK,GAAG,OAAO,CAAC,SAAS,CAAC,CAAA;AAC9B,0CAAoC;AACpC,qDAAkE;AAElE,MAAM,GAAG,GAAG,OAAO,EAAE,CAAC;AACtB,MAAM,MAAM,GAAG,OAAO,CAAC,aAAa,CAAC,CAAC,SAAS,CAAC,CAAC;AAEjD,GAAG,CAAC,GAAG,CAAC,GAAG,EAAE,CAAC,GAAG,EAAE,GAAG,EAAE,IAAI,EAAE,EAAE;IAG/B,GAAG,CAAC,MAAM,CAAC,6BAA6B,EAAE,GAAG,CAAC,CAAC;IAC/C,GAAG,CAAC,MAAM,CAAC,8BAA8B,EAAE,+CAA+C,CAAC,CAAC;IAC5F,GAAG,CAAC,MAAM,CAAC,8BAA8B,EAAE,6BAA6B,CAAC,CAAC;IACxE,GAAG,CAAC,MAAM,CAAC,kCAAkC,EAAE,MAAM,CAAC,CAAC;IACzD,GAAG,CAAC,MAAM,CAAC,cAAc,EAAE,OAAO,CAAC,CAAA;IACnC,EAAE,CAAC,CAAC,GAAG,CAAC,MAAM,IAAI,SAAS,CAAC,CAAC,CAAC;QAC3B,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;IACjB,CAAC;IAAC,IAAI,CAAC,CAAC;QACJ,IAAI,EAAE,CAAC;IACX,CAAC;AACF,CAAC,CAAC,CAAC;AAEH,QAAQ,CAAC,OAAO,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC,MAAU,EAAE,EAAE;IAChD,OAAO,CAAC,GAAG,CAAC,qBAAqB,CAAC,CAAA;AACnC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,KAAS,EAAE,EAAE;IACtB,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAA;AACnB,CAAC,CAAC,CAAA;AAEF,IAAI,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,CAAA;AAEvB,eAAM,CAAC,GAAG,CAAC,CAAC;AAEZ,uBAAe,EAAE,CAAA;AAEjB,GAAG,CAAC,GAAG,CAAC,OAAO,EAAE,CAAC,CAAC;AACnB,GAAG,CAAC,GAAG,CAAC,OAAO,CAAC,MAAM,CAAC,WAAW,CAAC,CAAC,CAAA;AAEpC,GAAG,CAAC,MAAM,CAAC,MAAM,CAAC,IAAI,EAAC,CAAC,GAAO,EAAE,EAAE;IAC/B,EAAE,CAAA,CAAC,GAAG,CAAC,CAAC,CAAC;QACL,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAA;IACpB,CAAC;IAAC,IAAI,CAAC,CAAC;QACJ,OAAO,CAAC,GAAG,CAAC,+BAA+B,EAAC,MAAM,CAAC,IAAI,CAAC,CAAA;IAC5D,CAAC;AACL,CAAC,CAAC,CAAA","sourcesContent":["import * as express from 'express';\r\nconst mongoose = require('mongoose');\r\nimport * as cookieParser from 'cookie-parser';\r\nimport * as history from 'connect-history-api-fallback';\r\n// import * as Redis from 'ioredis';\r\nvar Redis = require('ioredis')\r\nimport router from './routes/index';\r\nimport Wechat,{ startCreateMenu } from './controller/wechat/index'\r\n\r\nconst app = express();\r\nconst config = require('config-lite')(__dirname);\r\n\r\napp.all('*', (req, res, next) => {\r\n\t// const origin = req.headers.origin;\r\n\t// res.header(\"Access-Control-Allow-Origin\", req.headers.origin || '*');\r\n\tres.header(\"Access-Control-Allow-Origin\", '*');\r\n\tres.header(\"Access-Control-Allow-Headers\", \"Content-Type, Authorization, X-Requested-With\");\r\n\tres.header(\"Access-Control-Allow-Methods\", \"PUT,POST,GET,DELETE,OPTIONS\");\r\n  \tres.header(\"Access-Control-Allow-Credentials\", 'true'); //可以带cookies\r\n\tres.header(\"X-Powered-By\", '3.2.1')\r\n\tif (req.method == 'OPTIONS') {\r\n\t  \tres.send(200);\r\n\t} else {\r\n\t    next();\r\n\t}\r\n});\r\n\r\nmongoose.connect(config.url).then((result:any) => {\r\n\tconsole.log('mongoose is connect')\r\n}).catch((error:any) => {\r\n\tconsole.log(error)\r\n})\r\n\r\nnew Redis(config.redis)\r\n\r\nrouter(app);\r\n\r\nstartCreateMenu()\r\n\r\napp.use(history());\r\napp.use(express.static('../public'))\r\n\r\napp.listen(config.port,(err:any) => {\r\n    if(err) {\r\n        console.log(err)\r\n    } else {\r\n        console.log('my server is start,port is %s',config.port)\r\n    }\r\n})"]}